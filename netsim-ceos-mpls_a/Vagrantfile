Vagrant.configure("2") do |config|

VAGRANT_COMMAND = ARGV[0]

$cumulus_script = <<-SCRIPT
function set_cumulus_password(){
    echo "### Setting cumulus user password to 'cumulus' ###"
    echo "cumulus ALL=(ALL) NOPASSWD:ALL" > /etc/sudoers.d/10_cumulus
    echo "cumulus:cumulus" | chpasswd
    mkdir /home/cumulus/.ssh/
    cat /home/vagrant/.ssh/authorized_keys >> /home/cumulus/.ssh/authorized_keys
    chown -R cumulus:cumulus /home/cumulus/.ssh/
    chmod 0700 /home/cumulus/.ssh/
    chmod 0600 /home/cumulus/.ssh/authorized_keys
}
function disable_ztp(){
    echo "### Disabling ZTP service..."
    systemctl stop ztp.service
    ztp -d 2>&1
}
if grep -q -i 'cumulus' /etc/lsb-release &> /dev/null; then
    echo "### RUNNING CUMULUS EXTRA CONFIG ###"
    set_cumulus_password
    disable_ztp
fi
SCRIPT

  config.vm.define "rr1" do |rr1|
    rr1.vm.provider :libvirt do |domain|
      domain.management_network_mac = "08-4F-A9-00-00-01"
      domain.qemu_use_session = false
    end
    rr1.vm.box = "arista/veos"
    rr1.vm.synced_folder ".", "/vagrant", id: "vagrant-root", disabled: true
    rr1.ssh.insert_key = false
    rr1.ssh.shell = "bash"
    rr1.vm.guest = :freebsd

    rr1.vm.provider :libvirt do |domain|
      domain.disk_bus = 'ide'
      domain.cpus = 2
      domain.memory = 2048
      domain.driver = "kvm"
    end
    rr1.vm.provider :libvirt do |domain|
    end

    rr1.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.1.1",
                  :libvirt__tunnel_local_port => "10001",
                  :libvirt__tunnel_ip => "127.1.3.1",
                  :libvirt__tunnel_port => "10001",
                  :libvirt__iface_name => "vgif_rr1_1",
                  auto_config: false
    rr1.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.1.2",
                  :libvirt__tunnel_local_port => "10002",
                  :libvirt__tunnel_ip => "127.1.4.1",
                  :libvirt__tunnel_port => "10001",
                  :libvirt__iface_name => "vgif_rr1_2",
                  auto_config: false
    rr1.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.1.3",
                  :libvirt__tunnel_local_port => "10003",
                  :libvirt__tunnel_ip => "127.1.13.1",
                  :libvirt__tunnel_port => "10001",
                  :libvirt__iface_name => "vgif_rr1_3",
                  auto_config: false
  end
  config.vm.define "rr2" do |rr2|
    rr2.vm.provider :libvirt do |domain|
      domain.management_network_mac = "08-4F-A9-00-00-02"
      domain.qemu_use_session = false
    end
    rr2.vm.box = "arista/veos"
    rr2.vm.synced_folder ".", "/vagrant", id: "vagrant-root", disabled: true
    rr2.ssh.insert_key = false
    rr2.ssh.shell = "bash"
    rr2.vm.guest = :freebsd

    rr2.vm.provider :libvirt do |domain|
      domain.disk_bus = 'ide'
      domain.cpus = 2
      domain.memory = 2048
      domain.driver = "kvm"
    end
    rr2.vm.provider :libvirt do |domain|
    end

    rr2.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.2.1",
                  :libvirt__tunnel_local_port => "10001",
                  :libvirt__tunnel_ip => "127.1.3.2",
                  :libvirt__tunnel_port => "10002",
                  :libvirt__iface_name => "vgif_rr2_1",
                  auto_config: false
    rr2.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.2.2",
                  :libvirt__tunnel_local_port => "10002",
                  :libvirt__tunnel_ip => "127.1.4.2",
                  :libvirt__tunnel_port => "10002",
                  :libvirt__iface_name => "vgif_rr2_2",
                  auto_config: false
  end
  config.vm.define "pe1" do |pe1|
    pe1.vm.provider :libvirt do |domain|
      domain.management_network_mac = "08-4F-A9-00-00-03"
      domain.qemu_use_session = false
    end
    pe1.vm.box = "arista/veos"
    pe1.vm.synced_folder ".", "/vagrant", id: "vagrant-root", disabled: true
    pe1.ssh.insert_key = false
    pe1.ssh.shell = "bash"
    pe1.vm.guest = :freebsd

    pe1.vm.provider :libvirt do |domain|
      domain.disk_bus = 'ide'
      domain.cpus = 2
      domain.memory = 2048
      domain.driver = "kvm"
    end
    pe1.vm.provider :libvirt do |domain|
    end

    pe1.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.3.1",
                  :libvirt__tunnel_local_port => "10001",
                  :libvirt__tunnel_ip => "127.1.1.1",
                  :libvirt__tunnel_port => "10001",
                  :libvirt__iface_name => "vgif_pe1_1",
                  auto_config: false
    pe1.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.3.2",
                  :libvirt__tunnel_local_port => "10002",
                  :libvirt__tunnel_ip => "127.1.2.1",
                  :libvirt__tunnel_port => "10001",
                  :libvirt__iface_name => "vgif_pe1_2",
                  auto_config: false
    pe1.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.3.3",
                  :libvirt__tunnel_local_port => "10003",
                  :libvirt__tunnel_ip => "127.1.10.1",
                  :libvirt__tunnel_port => "10001",
                  :libvirt__iface_name => "vgif_pe1_3",
                  auto_config: false
    pe1.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.3.4",
                  :libvirt__tunnel_local_port => "10004",
                  :libvirt__tunnel_ip => "127.1.11.1",
                  :libvirt__tunnel_port => "10001",
                  :libvirt__iface_name => "vgif_pe1_4",
                  auto_config: false
    pe1.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.3.5",
                  :libvirt__tunnel_local_port => "10005",
                  :libvirt__tunnel_ip => "127.1.5.1",
                  :libvirt__tunnel_port => "10001",
                  :libvirt__iface_name => "vgif_pe1_5",
                  auto_config: false
    pe1.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.3.6",
                  :libvirt__tunnel_local_port => "10006",
                  :libvirt__tunnel_ip => "127.1.8.1",
                  :libvirt__tunnel_port => "10001",
                  :libvirt__iface_name => "vgif_pe1_6",
                  auto_config: false
  end
  config.vm.define "pe2" do |pe2|
    pe2.vm.provider :libvirt do |domain|
      domain.management_network_mac = "08-4F-A9-00-00-04"
      domain.qemu_use_session = false
    end
    pe2.vm.box = "arista/veos"
    pe2.vm.synced_folder ".", "/vagrant", id: "vagrant-root", disabled: true
    pe2.ssh.insert_key = false
    pe2.ssh.shell = "bash"
    pe2.vm.guest = :freebsd

    pe2.vm.provider :libvirt do |domain|
      domain.disk_bus = 'ide'
      domain.cpus = 2
      domain.memory = 2048
      domain.driver = "kvm"
    end
    pe2.vm.provider :libvirt do |domain|
    end

    pe2.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.4.1",
                  :libvirt__tunnel_local_port => "10001",
                  :libvirt__tunnel_ip => "127.1.1.2",
                  :libvirt__tunnel_port => "10002",
                  :libvirt__iface_name => "vgif_pe2_1",
                  auto_config: false
    pe2.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.4.2",
                  :libvirt__tunnel_local_port => "10002",
                  :libvirt__tunnel_ip => "127.1.2.2",
                  :libvirt__tunnel_port => "10002",
                  :libvirt__iface_name => "vgif_pe2_2",
                  auto_config: false
    pe2.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.4.3",
                  :libvirt__tunnel_local_port => "10003",
                  :libvirt__tunnel_ip => "127.1.12.1",
                  :libvirt__tunnel_port => "10001",
                  :libvirt__iface_name => "vgif_pe2_3",
                  auto_config: false
    pe2.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.4.4",
                  :libvirt__tunnel_local_port => "10004",
                  :libvirt__tunnel_ip => "127.1.7.2",
                  :libvirt__tunnel_port => "10002",
                  :libvirt__iface_name => "vgif_pe2_4",
                  auto_config: false
    pe2.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.4.5",
                  :libvirt__tunnel_local_port => "10005",
                  :libvirt__tunnel_ip => "127.1.9.2",
                  :libvirt__tunnel_port => "10002",
                  :libvirt__iface_name => "vgif_pe2_5",
                  auto_config: false
  end
  config.vm.define "p1" do |p1|
    p1.vm.provider :libvirt do |domain|
      domain.management_network_mac = "08-4F-A9-00-00-05"
      domain.qemu_use_session = false
    end
    p1.vm.box = "arista/veos"
    p1.vm.synced_folder ".", "/vagrant", id: "vagrant-root", disabled: true
    p1.ssh.insert_key = false
    p1.ssh.shell = "bash"
    p1.vm.guest = :freebsd

    p1.vm.provider :libvirt do |domain|
      domain.disk_bus = 'ide'
      domain.cpus = 2
      domain.memory = 2048
      domain.driver = "kvm"
    end
    p1.vm.provider :libvirt do |domain|
    end

    p1.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.5.1",
                  :libvirt__tunnel_local_port => "10001",
                  :libvirt__tunnel_ip => "127.1.3.5",
                  :libvirt__tunnel_port => "10005",
                  :libvirt__iface_name => "vgif_p1_1",
                  auto_config: false
  end
  config.vm.define "p2" do |p2|
    p2.vm.provider :libvirt do |domain|
      domain.management_network_mac = "08-4F-A9-00-00-06"
      domain.qemu_use_session = false
    end
    p2.vm.box = "arista/veos"
    p2.vm.synced_folder ".", "/vagrant", id: "vagrant-root", disabled: true
    p2.ssh.insert_key = false
    p2.ssh.shell = "bash"
    p2.vm.guest = :freebsd

    p2.vm.provider :libvirt do |domain|
      domain.disk_bus = 'ide'
      domain.cpus = 2
      domain.memory = 2048
      domain.driver = "kvm"
    end
    p2.vm.provider :libvirt do |domain|
    end

    p2.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.6.1",
                  :libvirt__tunnel_local_port => "10001",
                  :libvirt__tunnel_ip => "127.1.6.2",
                  :libvirt__tunnel_port => "10002",
                  :libvirt__iface_name => "vgif_p2_1",
                  auto_config: false
    p2.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.6.2",
                  :libvirt__tunnel_local_port => "10002",
                  :libvirt__tunnel_ip => "127.1.6.1",
                  :libvirt__tunnel_port => "10001",
                  :libvirt__iface_name => "vgif_p2_2",
                  auto_config: false
    p2.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.6.3",
                  :libvirt__tunnel_local_port => "10003",
                  :libvirt__tunnel_ip => "127.1.7.1",
                  :libvirt__tunnel_port => "10001",
                  :libvirt__iface_name => "vgif_p2_3",
                  auto_config: false
  end
  config.vm.define "p3" do |p3|
    p3.vm.provider :libvirt do |domain|
      domain.management_network_mac = "08-4F-A9-00-00-07"
      domain.qemu_use_session = false
    end
    p3.vm.box = "arista/veos"
    p3.vm.synced_folder ".", "/vagrant", id: "vagrant-root", disabled: true
    p3.ssh.insert_key = false
    p3.ssh.shell = "bash"
    p3.vm.guest = :freebsd

    p3.vm.provider :libvirt do |domain|
      domain.disk_bus = 'ide'
      domain.cpus = 2
      domain.memory = 2048
      domain.driver = "kvm"
    end
    p3.vm.provider :libvirt do |domain|
    end

    p3.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.7.1",
                  :libvirt__tunnel_local_port => "10001",
                  :libvirt__tunnel_ip => "127.1.6.3",
                  :libvirt__tunnel_port => "10003",
                  :libvirt__iface_name => "vgif_p3_1",
                  auto_config: false
    p3.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.7.2",
                  :libvirt__tunnel_local_port => "10002",
                  :libvirt__tunnel_ip => "127.1.4.4",
                  :libvirt__tunnel_port => "10004",
                  :libvirt__iface_name => "vgif_p3_2",
                  auto_config: false
  end
  config.vm.define "p4" do |p4|
    p4.vm.provider :libvirt do |domain|
      domain.management_network_mac = "08-4F-A9-00-00-08"
      domain.qemu_use_session = false
    end
    p4.vm.box = "arista/veos"
    p4.vm.synced_folder ".", "/vagrant", id: "vagrant-root", disabled: true
    p4.ssh.insert_key = false
    p4.ssh.shell = "bash"
    p4.vm.guest = :freebsd

    p4.vm.provider :libvirt do |domain|
      domain.disk_bus = 'ide'
      domain.cpus = 2
      domain.memory = 2048
      domain.driver = "kvm"
    end
    p4.vm.provider :libvirt do |domain|
    end

    p4.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.8.1",
                  :libvirt__tunnel_local_port => "10001",
                  :libvirt__tunnel_ip => "127.1.3.6",
                  :libvirt__tunnel_port => "10006",
                  :libvirt__iface_name => "vgif_p4_1",
                  auto_config: false
    p4.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.8.2",
                  :libvirt__tunnel_local_port => "10002",
                  :libvirt__tunnel_ip => "127.1.9.1",
                  :libvirt__tunnel_port => "10001",
                  :libvirt__iface_name => "vgif_p4_2",
                  auto_config: false
  end
  config.vm.define "p5" do |p5|
    p5.vm.provider :libvirt do |domain|
      domain.management_network_mac = "08-4F-A9-00-00-09"
      domain.qemu_use_session = false
    end
    p5.vm.box = "arista/veos"
    p5.vm.synced_folder ".", "/vagrant", id: "vagrant-root", disabled: true
    p5.ssh.insert_key = false
    p5.ssh.shell = "bash"
    p5.vm.guest = :freebsd

    p5.vm.provider :libvirt do |domain|
      domain.disk_bus = 'ide'
      domain.cpus = 2
      domain.memory = 2048
      domain.driver = "kvm"
    end
    p5.vm.provider :libvirt do |domain|
    end

    p5.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.9.1",
                  :libvirt__tunnel_local_port => "10001",
                  :libvirt__tunnel_ip => "127.1.8.2",
                  :libvirt__tunnel_port => "10002",
                  :libvirt__iface_name => "vgif_p5_1",
                  auto_config: false
    p5.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.9.2",
                  :libvirt__tunnel_local_port => "10002",
                  :libvirt__tunnel_ip => "127.1.4.5",
                  :libvirt__tunnel_port => "10005",
                  :libvirt__iface_name => "vgif_p5_2",
                  auto_config: false
  end
  config.vm.define "c11" do |c11|
    c11.vm.provider :libvirt do |domain|
      domain.management_network_mac = "08-4F-A9-00-00-0A"
      domain.qemu_use_session = false
    end
    c11.vm.box = "arista/veos"
    c11.vm.synced_folder ".", "/vagrant", id: "vagrant-root", disabled: true
    c11.ssh.insert_key = false
    c11.ssh.shell = "bash"
    c11.vm.guest = :freebsd

    c11.vm.provider :libvirt do |domain|
      domain.disk_bus = 'ide'
      domain.cpus = 2
      domain.memory = 2048
      domain.driver = "kvm"
    end
    c11.vm.provider :libvirt do |domain|
    end

    c11.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.10.1",
                  :libvirt__tunnel_local_port => "10001",
                  :libvirt__tunnel_ip => "127.1.3.3",
                  :libvirt__tunnel_port => "10003",
                  :libvirt__iface_name => "vgif_c11_1",
                  auto_config: false
  end
  config.vm.define "c12" do |c12|
    c12.vm.provider :libvirt do |domain|
      domain.management_network_mac = "08-4F-A9-00-00-0B"
      domain.qemu_use_session = false
    end
    c12.vm.box = "arista/veos"
    c12.vm.synced_folder ".", "/vagrant", id: "vagrant-root", disabled: true
    c12.ssh.insert_key = false
    c12.ssh.shell = "bash"
    c12.vm.guest = :freebsd

    c12.vm.provider :libvirt do |domain|
      domain.disk_bus = 'ide'
      domain.cpus = 2
      domain.memory = 2048
      domain.driver = "kvm"
    end
    c12.vm.provider :libvirt do |domain|
    end

    c12.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.11.1",
                  :libvirt__tunnel_local_port => "10001",
                  :libvirt__tunnel_ip => "127.1.3.4",
                  :libvirt__tunnel_port => "10004",
                  :libvirt__iface_name => "vgif_c12_1",
                  auto_config: false
  end
  config.vm.define "c21" do |c21|
    c21.vm.provider :libvirt do |domain|
      domain.management_network_mac = "08-4F-A9-00-00-0C"
      domain.qemu_use_session = false
    end
    c21.vm.box = "arista/veos"
    c21.vm.synced_folder ".", "/vagrant", id: "vagrant-root", disabled: true
    c21.ssh.insert_key = false
    c21.ssh.shell = "bash"
    c21.vm.guest = :freebsd

    c21.vm.provider :libvirt do |domain|
      domain.disk_bus = 'ide'
      domain.cpus = 2
      domain.memory = 2048
      domain.driver = "kvm"
    end
    c21.vm.provider :libvirt do |domain|
    end

    c21.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.12.1",
                  :libvirt__tunnel_local_port => "10001",
                  :libvirt__tunnel_ip => "127.1.4.3",
                  :libvirt__tunnel_port => "10003",
                  :libvirt__iface_name => "vgif_c21_1",
                  auto_config: false
  end
  config.vm.define "x1" do |x1|
    x1.vm.provider :libvirt do |domain|
      domain.management_network_mac = "08-4F-A9-00-00-0D"
      domain.qemu_use_session = false
    end
    x1.vm.box = "arista/veos"
    x1.vm.synced_folder ".", "/vagrant", id: "vagrant-root", disabled: true
    x1.ssh.insert_key = false
    x1.ssh.shell = "bash"
    x1.vm.guest = :freebsd

    x1.vm.provider :libvirt do |domain|
      domain.disk_bus = 'ide'
      domain.cpus = 2
      domain.memory = 2048
      domain.driver = "kvm"
    end
    x1.vm.provider :libvirt do |domain|
    end

    x1.vm.network :private_network,
                  :libvirt__tunnel_type => "udp",
                  :libvirt__tunnel_local_ip => "127.1.13.1",
                  :libvirt__tunnel_local_port => "10001",
                  :libvirt__tunnel_ip => "127.1.1.3",
                  :libvirt__tunnel_port => "10003",
                  :libvirt__iface_name => "vgif_x1_1",
                  auto_config: false
  end
end